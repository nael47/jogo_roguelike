(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();class b{canvas;ctx;constructor(e){const t=document.getElementById(e);if(!t)throw new Error(`Canvas with id ${e} not found`);this.canvas=t;const s=this.canvas.getContext("2d");if(!s)throw new Error("Could not get 2D context");this.ctx=s,this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}clear(){this.ctx.fillStyle="#1a1a1a",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}getContext(){return this.ctx}get width(){return this.canvas.width}get height(){return this.canvas.height}}class A{joystickBase;joystickStick;active=!1;startX=0;startY=0;currentX=0;currentY=0;MAX_RADIUS=50;axisX=0;axisY=0;isTouchActive=!1;constructor(){this.joystickBase=document.createElement("div"),this.joystickBase.id="joystick-base",this.joystickStick=document.createElement("div"),this.joystickStick.id="joystick-stick",this.joystickBase.appendChild(this.joystickStick),document.body.appendChild(this.joystickBase),this.joystickBase.style.display="none",this.setupListeners()}setupListeners(){window.addEventListener("touchstart",e=>{this.isTouchActive=!0,!e.target.closest(".card")&&e.target.closest("button")},{passive:!1}),document.addEventListener("touchstart",e=>this.handleTouchStart(e),{passive:!1}),document.addEventListener("touchmove",e=>this.handleTouchMove(e),{passive:!1}),document.addEventListener("touchend",e=>this.handleTouchEnd(e))}handleTouchStart(e){if(e.target.closest("#modal-layer")||e.target.closest("button"))return;e.preventDefault();const t=e.changedTouches[0];this.active=!0,this.startX=t.clientX,this.startY=t.clientY,this.currentX=this.startX,this.currentY=this.startY,this.joystickBase.style.display="block",this.joystickBase.style.left=`${this.startX-this.MAX_RADIUS}px`,this.joystickBase.style.top=`${this.startY-this.MAX_RADIUS}px`,this.joystickStick.style.transform="translate(0px, 0px)",this.updateAxis()}handleTouchMove(e){if(!this.active)return;e.preventDefault();const t=e.changedTouches[0];this.currentX=t.clientX,this.currentY=t.clientY,this.updateStickPosition(),this.updateAxis()}handleTouchEnd(e){this.active&&(this.active=!1,this.joystickBase.style.display="none",this.axisX=0,this.axisY=0)}updateStickPosition(){let e=this.currentX-this.startX,t=this.currentY-this.startY;if(Math.sqrt(e*e+t*t)>this.MAX_RADIUS){const i=Math.atan2(t,e);e=Math.cos(i)*this.MAX_RADIUS,t=Math.sin(i)*this.MAX_RADIUS}this.joystickStick.style.transform=`translate(${e}px, ${t}px)`}updateAxis(){let e=this.currentX-this.startX,t=this.currentY-this.startY;Math.abs(e)<10&&(e=0),Math.abs(t)<10&&(t=0),Math.sqrt(e*e+t*t)>0?(this.axisX=e/this.MAX_RADIUS,this.axisY=t/this.MAX_RADIUS,this.axisX=Math.max(-1,Math.min(1,this.axisX)),this.axisY=Math.max(-1,Math.min(1,this.axisY))):(this.axisX=0,this.axisY=0)}}class S{keys=new Set;touchControls;constructor(){this.touchControls=new A,window.addEventListener("keydown",e=>{this.keys.add(e.code)}),window.addEventListener("keyup",e=>{this.keys.delete(e.code)})}isKeyDown(e){return this.keys.has(e)}isMobile(){return this.touchControls.isTouchActive}getAxis(){let e=0,t=0;if((this.isKeyDown("KeyW")||this.isKeyDown("ArrowUp"))&&(t-=1),(this.isKeyDown("KeyS")||this.isKeyDown("ArrowDown"))&&(t+=1),(this.isKeyDown("KeyA")||this.isKeyDown("ArrowLeft"))&&(e-=1),(this.isKeyDown("KeyD")||this.isKeyDown("ArrowRight"))&&(e+=1),e!==0&&t!==0){const s=Math.sqrt(e*e+t*t);e/=s,t/=s}return(this.touchControls.axisX!==0||this.touchControls.axisY!==0)&&(e=this.touchControls.axisX,t=this.touchControls.axisY),{x:e,y:t}}}class M{static nextId=0;id;x;y;width;height;color;isMarkedForDeletion=!1;constructor(e,t,s,i,a){this.id=M.nextId++,this.x=e,this.y=t,this.width=s,this.height=i,this.color=a}update(e,...t){}draw(e){const t=e.getContext();t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}const E={WARRIOR:{hp:150,maxHp:150,damage:25,speed:180,attackSpeed:1.5,color:"#e74c3c",projectileCount:0,auraDamage:0,auraRange:0},ARCHER:{hp:80,maxHp:80,damage:15,speed:240,attackSpeed:2.5,color:"#2ecc71",projectileCount:1,auraDamage:0,auraRange:0},MAGE:{hp:60,maxHp:60,damage:35,speed:200,attackSpeed:1.2,color:"#3498db",projectileCount:1,auraDamage:0,auraRange:0}};class D extends M{stats;classType;xp=0;level=1;nextLevelXp=100;cooldownTimer=0;invulnerabilityTimer=0;image=null;constructor(e,t,s){const i=E[s];super(e,t,48,48,i.color),this.classType=s,this.stats={...i},s==="ARCHER"?(this.image=new Image,this.image.src="arqueiro.png"):s==="WARRIOR"?(this.image=new Image,this.image.src="guerreiro.png"):s==="MAGE"&&(this.image=new Image,this.image.src="mago.png")}update(e,t){const s=t.getAxis();this.x+=s.x*this.stats.speed*e,this.y+=s.y*this.stats.speed*e,this.cooldownTimer>0&&(this.cooldownTimer-=e),this.invulnerabilityTimer>0&&(this.invulnerabilityTimer-=e)}canShoot(){return this.cooldownTimer<=0}takeDamage(e){return this.invulnerabilityTimer>0?!1:(this.stats.hp-=e,this.invulnerabilityTimer=.5,!0)}resetCooldown(){this.cooldownTimer=1/this.stats.attackSpeed}gainXp(e){return this.xp+=e,this.xp>=this.nextLevelXp?(this.xp-=this.nextLevelXp,this.level++,this.nextLevelXp=Math.floor(this.nextLevelXp*1.5),!0):!1}draw(e){this.image&&this.image.complete?e.getContext().drawImage(this.image,this.x,this.y,this.width,this.height):super.draw(e)}}class f extends M{hp;maxHp;speed;damage;static zombieImage=null;constructor(e,t){super(e,t,48,48,"#ff0000"),this.hp=50,this.maxHp=50,this.speed=100,this.damage=10,f.zombieImage||(f.zombieImage=new Image,f.zombieImage.src="zombie.png")}update(e,t){const s=t.x-this.x,i=t.y-this.y,a=Math.sqrt(s*s+i*i);a>0&&(this.x+=s/a*this.speed*e,this.y+=i/a*this.speed*e)}draw(e){f.zombieImage&&f.zombieImage.complete?e.getContext().drawImage(f.zombieImage,this.x,this.y,this.width,this.height):super.draw(e)}}class d extends M{vx;vy;damage;isPlayerOwned;homing=!1;target=null;lifeTime=2;static arrowImage=null;static fireballImage=null;static swordImage=null;isArrow=!1;isFireball=!1;isSword=!1;hitEnemies=new Set;constructor(e,t,s,i,a,h,p=!1,u=null,r=!1,o=!1,c=!1){super(e,t,8,8,h?"#ffff00":"#ff00ff"),this.vx=s,this.vy=i,this.damage=a,this.isPlayerOwned=h,this.homing=p,this.target=u,this.isArrow=r,this.isFireball=o,this.isSword=c,d.arrowImage||(d.arrowImage=new Image,d.arrowImage.src="flecha.png"),d.fireballImage||(d.fireballImage=new Image,d.fireballImage.src="bola_de_fogo.png"),d.swordImage||(d.swordImage=new Image,d.swordImage.src="espada_guerreiro.png")}update(e){if(this.homing&&this.target&&!this.target.isMarkedForDeletion){const t=this.target.x-this.x,s=this.target.y-this.y,i=Math.sqrt(t*t+s*s);if(i>0){const a=Math.sqrt(this.vx*this.vx+this.vy*this.vy);this.vx=t/i*a,this.vy=s/i*a}}this.x+=this.vx*e,this.y+=this.vy*e,this.lifeTime-=e,this.lifeTime<=0&&(this.isMarkedForDeletion=!0)}draw(e){if(this.isArrow&&d.arrowImage&&d.arrowImage.complete){const t=e.getContext(),s=Math.atan2(this.vy,this.vx);t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(s),t.drawImage(d.arrowImage,-12,-12,24,24),t.restore()}else if(this.isFireball&&d.fireballImage&&d.fireballImage.complete){const t=e.getContext(),s=Math.atan2(this.vy,this.vx);t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(s),t.drawImage(d.fireballImage,-16,-16,32,32),t.restore()}else if(this.isSword&&d.swordImage&&d.swordImage.complete){const t=e.getContext(),s=Math.atan2(this.vy,this.vx);t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(s),t.drawImage(d.swordImage,-20,-20,40,40),t.restore()}else super.draw(e)}}class R{uiLayer;modalLayer;constructor(){this.uiLayer=document.getElementById("ui-layer"),this.modalLayer=document.getElementById("modal-layer"),this.setupHUD()}setupHUD(){this.uiLayer.innerHTML=`
      <div class="hud-container">
        <div id="hp-bar" class="stat-bar hp-bar">
          <div id="hp-fill" class="bar-fill hp-fill"></div>
        </div>
        <div class="level-info">Level: <span id="level-display">1</span></div>
        <div id="xp-bar" class="stat-bar xp-bar">
          <div id="xp-fill" class="bar-fill xp-fill"></div>
        </div>
      </div>
      
      <!-- Wave Counter -->
      <div id="wave-counter" class="wave-counter">
        <div class="wave-label">FASE</div>
        <div id="wave-number" class="wave-number">1</div>
      </div>
    `}updateHUD(e){const t=document.getElementById("hp-fill"),s=document.getElementById("xp-fill"),i=document.getElementById("level-display");if(t){const a=Math.max(0,e.stats.hp/e.stats.maxHp*100);t.style.width=`${a}%`}if(s){const a=e.xp/e.nextLevelXp*100;s.style.width=`${a}%`}i&&(i.innerText=e.level.toString())}updateWave(e){const t=document.getElementById("wave-number");t&&(t.innerText=e.toString())}updateObjective(e,t,s,i,a){let h=document.getElementById("objective-display");if(h||(h=document.createElement("div"),h.id="objective-display",h.className="objective-display",this.uiLayer.appendChild(h)),e==="ELIMINATION"){const p=Math.min(100,t/s*100);h.innerHTML=`
        <div class="objective-title">OBJETIVO: Eliminar ${s} Zumbis</div>
        <div class="objective-bar-container">
          <div class="objective-bar-fill elimination" style="width: ${p}%;"></div>
        </div>
        <div class="objective-text">${t} / ${s}</div>
      `}else{const p=Math.max(0,a-i),u=Math.floor(p/60),r=Math.floor(p%60),o=Math.min(100,i/a*100);h.innerHTML=`
        <div class="objective-title">OBJETIVO: Sobreviver por 3 Minutos</div>
        <div class="objective-bar-container">
          <div class="objective-bar-fill survival" style="width: ${o}%;"></div>
        </div>
        <div class="objective-text">${u}:${r.toString().padStart(2,"0")} restantes</div>
      `}}showClassSelection(e){this.modalLayer.innerHTML=`
      <div class="modal-overlay">
        <h1 class="modal-title">Escolha Sua Classe</h1>
        <div class="card-container class-selection">
          <div class="class-card warrior" data-class="WARRIOR">
            <h2>Guerreiro</h2>
            <p>Combate Corpo a Corpo</p>
            <p>HP Alto</p>
          </div>
          <div class="class-card archer" data-class="ARCHER">
            <h2>Arqueiro</h2>
            <p>Flechas Teleguiadas</p>
            <p>Velocidade Alta</p>
          </div>
          <div class="class-card mage" data-class="MAGE">
            <h2>Mago</h2>
            <p>Magia Teleguiada</p>
            <p>Dano Alto</p>
          </div>
        </div>
      </div>
    `,this.modalLayer.querySelectorAll(".class-card").forEach(s=>{s.addEventListener("click",()=>{const i=s.getAttribute("data-class");e(i),this.hideCardSelection()})})}showCardSelection(e,t){this.modalLayer.innerHTML=`
      <div class="modal-overlay">
        <h2 class="modal-subtitle">Subiu de Nível! Escolha uma Carta</h2>
        <div class="card-container upgrade-selection">
          ${e.map((i,a)=>`
            <div class="upgrade-card" data-index="${a}">
              <h3 class="card-name">${i.name}</h3>
              <p class="card-type">${i.type}</p>
              <p class="card-desc">${i.description}</p>
            </div>
          `).join("")}
        </div>
      </div>
    `,this.modalLayer.querySelectorAll(".upgrade-card").forEach(i=>{i.addEventListener("click",()=>{const a=parseInt(i.getAttribute("data-index")||"0");t(e[a]),this.hideCardSelection()})})}showGameOver(e){this.modalLayer.innerHTML=`
      <div class="modal-overlay">
        <h1 class="game-over-title">FIM DE JOGO</h1>
        <button id="restart-btn" class="btn btn-primary">
          Reiniciar
        </button>
      </div>
    `,document.getElementById("restart-btn").addEventListener("click",e)}showPauseMenu(e){this.modalLayer.innerHTML=`
      <div class="modal-overlay">
        <h1 class="pause-title">PAUSADO</h1>
        <button id="resume-btn" class="btn btn-success mb-20">
          Continuar (ESC)
        </button>
        <button id="restart-pause-btn" class="btn btn-danger">
          Reiniciar Jogo
        </button>
      </div>
    `,document.getElementById("resume-btn").addEventListener("click",e),document.getElementById("restart-pause-btn").addEventListener("click",()=>{location.reload()})}hidePauseMenu(){this.modalLayer.innerHTML=""}hideCardSelection(){this.modalLayer.innerHTML=""}}const L=[{id:"atk_boost",name:"Treinamento de Força",type:"ATTRIBUTE",description:"+20% de Dano",apply:n=>{n.stats.damage*=1.2}},{id:"spd_boost",name:"Leveza",type:"ATTRIBUTE",description:"+15% de Velocidade",apply:n=>{n.stats.speed*=1.15}},{id:"hp_boost",name:"Vitalidade",type:"ATTRIBUTE",description:"+30% de HP Máximo",apply:n=>{n.stats.maxHp*=1.3,n.stats.hp=n.stats.maxHp}},{id:"atk_spd",name:"Frenesi",type:"ATTRIBUTE",description:"+15% de Velocidade de Ataque",apply:n=>{n.stats.attackSpeed*=1.15}},{id:"multishot",name:"Tiro Múltiplo",type:"SKILL",description:"+1 Projétil",apply:n=>{n.stats.projectileCount+=1}},{id:"aura",name:"Aura Flamejante",type:"SKILL",description:"Causa dano a inimigos próximos",apply:n=>{n.stats.auraRange===0?(n.stats.auraRange=100,n.stats.auraDamage=5):(n.stats.auraRange*=1.2,n.stats.auraDamage*=1.5)}},{id:"crit_chance",name:"Precisão",type:"PASSIVE",description:"Ataques têm chance de causar dano dobrado (Não implementado ainda)",apply:n=>{}}];class C{getRandomCards(e){return[...L].sort(()=>.5-Math.random()).slice(0,e)}applyCard(e,t){t.apply(e),console.log(`Applied card: ${t.name}`)}}class y{renderer;input;ui;cardManager;lastTime=0;player;enemies=[];projectiles=[];spawnTimer=0;isPaused=!1;state="MENU";gameTime=0;auraTickTimer=0;currentWave=1;enemiesSpawnedThisWave=0;enemiesPerWave=10;waveObjective="ELIMINATION";waveStartTime=0;killsThisWave=0;SURVIVAL_TIME=180;ELIMINATION_TARGET=100;hordeTimer=0;HORDE_INTERVAL=30;HORDE_SIZE=20;HORDE_WARNING_TIME=3;showHordeWarning=!1;static hordeWarningImage=null;static sirenSound=null;sirenPlayed=!1;escPressed=!1;constructor(){this.renderer=new b("gameCanvas"),this.input=new S,this.ui=new R,this.cardManager=new C,y.hordeWarningImage||(y.hordeWarningImage=new Image,y.hordeWarningImage.src="hordas_chegando_aviso.png"),y.sirenSound||(y.sirenSound=new Audio,this.createSirenSound()),this.ui.showClassSelection(e=>{this.startGame(e)}),requestAnimationFrame(e=>this.loop(e))}startGame(e){this.player=new D(this.renderer.width/2-16,this.renderer.height/2-16,e),this.state="PLAYING",this.waveStartTime=0}createSirenSound(){if(!y.sirenSound)return;const e=new(window.AudioContext||window.webkitAudioContext),t=2,s=e.sampleRate,i=e.createBuffer(1,t*s,s),a=i.getChannelData(0);for(let u=0;u<i.length;u++){const r=u/s,o=400+Math.sin(r*4)*200;a[u]=Math.sin(2*Math.PI*o*r)*.3}const h=this.bufferToWave(i,i.length),p=new Blob([h],{type:"audio/wav"});y.sirenSound.src=URL.createObjectURL(p),y.sirenSound.volume=.4}bufferToWave(e,t){const s=e.numberOfChannels,i=t*s*2+44,a=new ArrayBuffer(i),h=new DataView(a),p=[];let u=0,r=0;const o=l=>{h.setUint16(r,l,!0),r+=2},c=l=>{h.setUint32(r,l,!0),r+=4};c(1179011410),c(i-8),c(1163280727),c(544501094),c(16),o(1),o(s),c(e.sampleRate),c(e.sampleRate*2*s),o(s*2),o(16),c(1635017060),c(i-r-4);for(let l=0;l<e.numberOfChannels;l++)p.push(e.getChannelData(l));for(;r<i;){for(let l=0;l<s;l++){let w=Math.max(-1,Math.min(1,p[l][u]));w=w<0?w*32768:w*32767,h.setInt16(r,w,!0),r+=2}u++}return a}loop(e){const t=(e-this.lastTime)/1e3;this.lastTime=e,this.state==="PLAYING"&&!this.isPaused&&this.player&&this.update(t),this.state==="PLAYING"&&this.player&&(this.input.isKeyDown("Escape")&&!this.escPressed?(this.escPressed=!0,this.togglePause()):this.input.isKeyDown("Escape")||(this.escPressed=!1)),this.draw(),requestAnimationFrame(s=>this.loop(s))}update(e){if(!this.player)return;this.gameTime+=e,this.waveStartTime+=e,this.player.update(e,this.input),this.player.stats.auraRange>0&&(this.auraTickTimer+=e,this.auraTickTimer>=.5&&(this.auraTickTimer=0,this.enemies.forEach(r=>{if(!this.player)return;Math.sqrt(Math.pow(r.x-this.player.x,2)+Math.pow(r.y-this.player.y,2))<=this.player.stats.auraRange&&(r.hp-=this.player.stats.auraDamage,r.hp<=0&&(r.isMarkedForDeletion=!0,this.killsThisWave++,this.player.gainXp(20)&&this.triggerLevelUp()))})));const t=this.input.isMobile(),s=this.input.getAxis(),i=s.x!==0||s.y!==0;if((this.input.isKeyDown("KeyJ")||t&&!i)&&this.player.canShoot())if(this.player.resetCooldown(),this.player.classType==="WARRIOR"){let r=0,o=0,c=null,l=1/0;for(const m of this.enemies){const g=Math.sqrt(Math.pow(m.x-this.player.x,2)+Math.pow(m.y-this.player.y,2));g<l&&(l=g,c=m)}if(c){const m=c.x-this.player.x,g=c.y-this.player.y,I=Math.sqrt(m*m+g*g);r=m/I,o=g/I}else this.input.isKeyDown("ArrowUp")||this.input.isKeyDown("KeyW")?o=-1:this.input.isKeyDown("ArrowDown")||this.input.isKeyDown("KeyS")?o=1:this.input.isKeyDown("ArrowLeft")||this.input.isKeyDown("KeyA")?r=-1:(this.input.isKeyDown("ArrowRight")||this.input.isKeyDown("KeyD"),r=1);const w=new d(this.player.x+16+r*20,this.player.y+16+o*20,r*10,o*10,this.player.stats.damage,!0,!1,null,!1,!1,!0);w.lifeTime=.2,this.projectiles.push(w)}else{const r=Math.max(1,this.player.stats.projectileCount);for(let o=0;o<r;o++){const c=o*500;setTimeout(()=>{if(!this.player)return;let l=null,w=1/0;for(const v of this.enemies){const x=Math.sqrt(Math.pow(v.x-this.player.x,2)+Math.pow(v.y-this.player.y,2));x<w&&(w=x,l=v)}let m=0,g=0;if(l){const v=l.x-this.player.x,x=l.y-this.player.y,T=Math.sqrt(v*v+x*x);m=v/T,g=x/T}else this.input.isKeyDown("ArrowUp")||this.input.isKeyDown("KeyW")?g=-1:this.input.isKeyDown("ArrowDown")||this.input.isKeyDown("KeyS")?g=1:this.input.isKeyDown("ArrowLeft")||this.input.isKeyDown("KeyA")?m=-1:(this.input.isKeyDown("ArrowRight")||this.input.isKeyDown("KeyD"),m=1);const I=600;if(m!==0&&g!==0&&!l){const v=Math.sqrt(m*m+g*g);m/=v,g/=v}this.projectiles.push(new d(this.player.x+16,this.player.y+16,m*I,g*I,this.player.stats.damage,!0,!0,l,this.player.classType==="ARCHER",this.player.classType==="MAGE"))},c)}}this.projectiles.forEach(r=>r.update(e)),this.projectiles=this.projectiles.filter(r=>!r.isMarkedForDeletion),this.player&&this.enemies.forEach(r=>r.update(e,this.player));const h=2,p=Math.max(.2,1-this.gameTime/30*.1),u=Math.max(.5,h*p);this.spawnTimer+=e,this.spawnTimer>u&&(this.spawnTimer=0,this.spawnEnemy(),this.enemiesSpawnedThisWave++),this.hordeTimer+=e,this.hordeTimer>=this.HORDE_INTERVAL-this.HORDE_WARNING_TIME&&this.hordeTimer<this.HORDE_INTERVAL?(this.showHordeWarning||(this.showHordeWarning=!0,this.sirenPlayed=!1),!this.sirenPlayed&&y.sirenSound&&(y.sirenSound.currentTime=0,y.sirenSound.play().catch(r=>console.log("Audio play failed:",r)),this.sirenPlayed=!0)):this.showHordeWarning=!1,this.hordeTimer>=this.HORDE_INTERVAL&&(this.hordeTimer=0,this.showHordeWarning=!1,this.sirenPlayed=!1,this.spawnHorde()),this.checkWaveCompletion(),this.checkCollisions(),this.ui.updateHUD(this.player),this.ui.updateWave(this.currentWave),this.ui.updateObjective(this.waveObjective,this.killsThisWave,this.ELIMINATION_TARGET,this.waveStartTime,this.SURVIVAL_TIME)}checkWaveCompletion(){let e=!1;this.waveObjective==="ELIMINATION"?this.killsThisWave>=this.ELIMINATION_TARGET&&(e=!0):this.waveStartTime>=this.SURVIVAL_TIME&&(e=!0),e&&this.nextWave()}nextWave(){this.currentWave++,this.enemiesSpawnedThisWave=0,this.killsThisWave=0,this.waveStartTime=0,this.waveObjective=this.currentWave%5===0?"SURVIVAL":"ELIMINATION",this.enemiesPerWave=Math.floor(this.enemiesPerWave*1.2),this.triggerWaveReward()}triggerWaveReward(){if(!this.player)return;this.isPaused=!0;const e=this.cardManager.getRandomCards(3);this.ui.showCardSelection(e,t=>{this.player&&this.cardManager.applyCard(this.player,t),this.isPaused=!1})}spawnEnemy(){const e=Math.floor(Math.random()*4);let t=0,s=0;switch(e){case 0:t=Math.random()*this.renderer.width,s=-50;break;case 1:t=Math.random()*this.renderer.width,s=this.renderer.height+50;break;case 2:t=-50,s=Math.random()*this.renderer.height;break;case 3:t=this.renderer.width+50,s=Math.random()*this.renderer.height;break}this.enemies.push(new f(t,s))}spawnHorde(){const e=Math.floor(this.HORDE_SIZE/4);for(let t=0;t<e;t++){const s=this.renderer.width/e*t;this.enemies.push(new f(s,-50))}for(let t=0;t<e;t++){const s=this.renderer.width/e*t;this.enemies.push(new f(s,this.renderer.height+50))}for(let t=0;t<e;t++){const s=this.renderer.height/e*t;this.enemies.push(new f(-50,s))}for(let t=0;t<e;t++){const s=this.renderer.height/e*t;this.enemies.push(new f(this.renderer.width+50,s))}}checkCollisions(){if(this.player){for(const e of this.projectiles)if(e.isPlayerOwned){for(const t of this.enemies)if(this.isColliding(e,t)){if(e.isSword){if(e.hitEnemies.has(t.id))continue;e.hitEnemies.add(t.id)}else e.isMarkedForDeletion=!0;if(t.hp-=e.damage,t.hp<=0&&(t.isMarkedForDeletion=!0,this.killsThisWave++,this.player.gainXp(20)&&this.triggerLevelUp()),!e.isSword)break}}this.enemies=this.enemies.filter(e=>!e.isMarkedForDeletion);for(const e of this.enemies){const t=e.x+e.width/2,s=e.y+e.height/2,i=this.player.x+this.player.width/2,a=this.player.y+this.player.height/2;if(Math.sqrt(Math.pow(i-t,2)+Math.pow(a-s,2))<20&&this.player.takeDamage(10)){const p=this.player.x-e.x,u=this.player.y-e.y,r=Math.sqrt(p*p+u*u);r>0&&(this.player.x+=p/r*20,this.player.y+=u/r*20),this.player.stats.hp<=0&&this.gameOver()}}}}gameOver(){this.isPaused=!0,this.ui.showGameOver(()=>{location.reload()})}triggerLevelUp(){if(!this.player)return;this.isPaused=!0;const e=this.cardManager.getRandomCards(3);this.ui.showCardSelection(e,t=>{this.player&&this.cardManager.applyCard(this.player,t),this.isPaused=!1})}togglePause(){this.isPaused=!this.isPaused,this.isPaused?this.ui.showPauseMenu(()=>{this.isPaused=!1}):this.ui.hidePauseMenu()}isColliding(e,t){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}draw(){if(this.renderer.clear(),this.player&&this.player.stats.auraRange>0){const e=this.renderer.getContext();e.beginPath(),e.arc(this.player.x+16,this.player.y+16,this.player.stats.auraRange,0,Math.PI*2),e.fillStyle="rgba(231, 76, 60, 0.2)",e.fill(),e.strokeStyle="rgba(231, 76, 60, 0.5)",e.lineWidth=2,e.stroke()}if(this.player&&this.player.draw(this.renderer),this.enemies.forEach(e=>e.draw(this.renderer)),this.projectiles.forEach(e=>e.draw(this.renderer)),this.showHordeWarning&&y.hordeWarningImage&&y.hordeWarningImage.complete){const e=this.renderer.getContext(),t=400,s=200,i=(this.renderer.width-t)/2,a=(this.renderer.height-s)/2;e.drawImage(y.hordeWarningImage,i,a,t,s)}}}window.addEventListener("DOMContentLoaded",()=>{new y});
